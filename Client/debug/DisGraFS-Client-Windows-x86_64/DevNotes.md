# Development Notes

## setup.bat

- For Windows only
- Assumes python3 has been installed and `python.exe` has been added to `path`
- Installs `watchdog` module for python
- Generates `DisGraFS-Client-Register-Generated.reg` for current working directory and opens it with regedit
- Should be re-run every time the folder is moved

## DisGraFS-Client-Register-Generated.reg

- For Windows only

- Automatically generated by `setup.bat`, can be deleted after use
- Adds `URL:disgrafs Protocol Handler` to registry, which points to current working directory's `DisGraFS-Client.py`

## DisGraFS-Client.py

- Platform independent

- First called by `disgrafs://` URL protocol, and will keep running until killed by user or server
  - Format: `disgrafs://[redisUrl] [mountPoint] [wsUrl] [wsAuth]`
  - Example: `disgrafs://redis://:disgrafs@juicefs.disgrafs.tech Z: ws://localhost:9090 admin:123456`
- Mounts JuiceFS
- Starts websocket connection as client
  - Listens to server commands
  - Command format: `{"command": "commandName", "parameter": ["param1", "param2", ...]}`
    - exit: `{"command": "exit", "parameter": []}`
    - open: `{"command": "open", "parameter": ["RollIt.jpg"]}`
- Establishes watchdog observer on mounted drive
  - Listens to filesystem events and reports to server via websocket
  - Report format: 
    - Create: `{"type": "create", "path1": "folder/newfile.txt", "path2": "", "time": 1619926181000}`
    - Modify: `{"type": "modify", "path1": "folder/modified.txt", "path2": "", "time": 1619926181000}`
    - Delete: `{"type": "delete", "path1": "folder/deleted.txt", "path2": "", "time": 1619926181000}`
    - Move: `{"type": "move", "path1": "oldfolder/oldname.txt", "path2": "newfolder/newname.txt", "time": 1619926181000}`

## juicefs.exe

- For Windows only
- Provided by JuiceFS
- Automatically called by `DisGraFS-Client.py`

